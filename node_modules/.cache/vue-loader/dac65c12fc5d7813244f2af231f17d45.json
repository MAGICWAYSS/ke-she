{"remainingRequest":"D:\\xiaomi\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\xiaomi\\vue\\src\\views\\Login.vue?vue&type=style&index=0&id=26084dc2&scoped=true&lang=css&","dependencies":[{"path":"D:\\xiaomi\\vue\\src\\views\\Login.vue","mtime":1684853306264},{"path":"D:\\xiaomi\\vue\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\xiaomi\\vue\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\xiaomi\\vue\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\xiaomi\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\xiaomi\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCi53cmFwcGVyIHsKICBoZWlnaHQ6IDEwMHZoOwogIGJhY2tncm91bmQtaW1hZ2U6IGxpbmVhci1ncmFkaWVudCh0byBib3R0b20gLCAjNDJiOTgzLCAjM0Y1RUZCKTsKICBvdmVyZmxvdzogaGlkZGVuOwp9Cg=="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmHA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div\n        style=\"margin: 200px auto; background-color: #fff; width: 350px; height: 300px; padding: 20px; border-radius: 10px\">\n      <div style=\"margin: 20px 0; text-align: center; font-size: 24px\"><b>登 录</b></div>\n      <el-form  :model=\"user\"  ref=\"userForm\" :rules=\"rules\">\n        <el-form-item prop=\"username\">\n          <el-input size=\"medium\" style=\"margin: 10px 0\" prefix-icon=\"el-icon-user\" v-model=\"user.username\"></el-input>\n        </el-form-item>\n        <el-form-item prop=\"password\">\n          <el-input size=\"medium\" style=\"margin: 10px 0\" prefix-icon=\"el-icon-lock\" show-password\n                    v-model=\"user.password\"></el-input>\n        </el-form-item>\n        <el-form-item style=\"margin: 10px 0; text-align: right\">\n          <el-button type=\"warning\" size=\"small\" autocomplete=\"off\" @click=\"$router.push('/register')\">注册</el-button>\n          <el-button type=\"primary\" size=\"small\" autocomplete=\"off\" @click=\"login\">登录</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {baseURL} from \"../../public/urlConfig\";\nimport axios from \"axios\";\n\nexport default {\n  name: \"Login\",\n  data() {\n    return {\n      user:{},\n      ip:\"\",\n      province:\"\",\n      city:\"\",\n      rules: {\n        username: [\n          {required: true, message: '请输入用户名', trigger: 'blur'},\n          {min: 1, message: '不能为空', trigger: 'blur'}\n        ],\n        password: [\n          {required: true, message: '请输入密码', trigger: 'blur'},\n          {min: 1,  message: '不能为空', trigger: 'blur'}\n        ],\n      }\n    }\n  },\n  created() {\n    this.load()\n  },\n  methods: {\n    login() {\n      this.$refs['userForm'].validate((valid) => {\n        if (valid) {  // 表单校验合法\n          var url = baseURL+\"/user/login\";\n          axios.get(url,{\n            params:{\n              username:this.user.username,\n              password:this.user.password\n            }\n          }).then((res)=>{\n            //res.data 才表示接口返回的数据\n            var vo = res.data;\n            if (vo.code === 10000) {\n              localStorage.setItem(\"username\", vo.data.username)  // 存储用户信息到浏览器\n              localStorage.setItem(\"img\", vo.data.userImg)  // 存储用户信息到浏览器\n              localStorage.setItem(\"token\",vo.msg)\n              localStorage.setItem(\"userId\",vo.data.userId)\n              // 动态设置当前用户的路由\n              this.$message.success(\"登录成功\")\n              this.getIp()\n              let hostName = this.$route.query.redirect;  // 获取域名\n              if (hostName !=null) {   // 判断如果域名是你项目域名，说明是从本网站内部跳转过来的，\n                this.$router.push(hostName);   // 登录成功后，返回上次进入的页面；\n              } else {\n                this.$router.push(\"/\");  // 若不是网站内部跳转过来的，登陆成功后进入网站首页\n              }\n            } else {\n              this.$message.error(res.data.msg)\n            }\n          })\n        }\n      });\n    },\n    load(){\n      axios.get(baseURL+\"/user-login-history/getIp\").then(\n          res=>{\n            this.ip=res.data\n            axios.get(\"https://restapi.amap.com/v3/ip\",{\n              params:{\n                ip:res.data,\n                key: '1983be331c48ef28867f61e61f878987',\n              }\n            }).then(\n                res=>{\n                  this.province=res.data.province\n                  this.city=res.data.city\n                }\n            )\n          }\n      )\n    },\n    getIp(){\n      var position={\n        \"area\":this.city,\n        \"ip\":this.ip,\n        \"userId\":localStorage.getItem(\"userId\"),\n        \"country\":this.province\n      }\n      axios.post(baseURL+\"/user-login-history/insert\",position)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wrapper {\n  height: 100vh;\n  background-image: linear-gradient(to bottom , #42b983, #3F5EFB);\n  overflow: hidden;\n}\n</style>\n"]}]}