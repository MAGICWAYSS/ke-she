{"remainingRequest":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\src\\views\\Login.vue?vue&type=script&lang=js&","dependencies":[{"path":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\src\\views\\Login.vue","mtime":1684822811275},{"path":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684824148122},{"path":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\node_modules\\babel-loader\\lib\\index.js","mtime":1684824148071},{"path":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1684824148122},{"path":"C:\\Users\\何睿\\Downloads\\retailSystem-master\\retailSystem-master\\vue\\node_modules\\vue-loader\\lib\\index.js","mtime":1684824144416}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7YmFzZVVSTH0gZnJvbSAiLi4vLi4vcHVibGljL3VybENvbmZpZyI7CmltcG9ydCBheGlvcyBmcm9tICJheGlvcyI7CgpleHBvcnQgZGVmYXVsdCB7CiAgbmFtZTogIkxvZ2luIiwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdXNlcjp7fSwKICAgICAgaXA6IiIsCiAgICAgIHByb3ZpbmNlOiIiLAogICAgICBjaXR5OiIiLAogICAgICBydWxlczogewogICAgICAgIHVzZXJuYW1lOiBbCiAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXnlKjmiLflkI0nLCB0cmlnZ2VyOiAnYmx1cid9LAogICAgICAgICAge21pbjogMSwgbWVzc2FnZTogJ+S4jeiDveS4uuepuicsIHRyaWdnZXI6ICdibHVyJ30KICAgICAgICBdLAogICAgICAgIHBhc3N3b3JkOiBbCiAgICAgICAgICB7cmVxdWlyZWQ6IHRydWUsIG1lc3NhZ2U6ICfor7fovpPlhaXlr4bnoIEnLCB0cmlnZ2VyOiAnYmx1cid9LAogICAgICAgICAge21pbjogMSwgIG1lc3NhZ2U6ICfkuI3og73kuLrnqbonLCB0cmlnZ2VyOiAnYmx1cid9CiAgICAgICAgXSwKICAgICAgfQogICAgfQogIH0sCiAgY3JlYXRlZCgpIHsKICAgIHRoaXMubG9hZCgpCiAgfSwKICBtZXRob2RzOiB7CiAgICBsb2dpbigpIHsKICAgICAgdGhpcy4kcmVmc1sndXNlckZvcm0nXS52YWxpZGF0ZSgodmFsaWQpID0+IHsKICAgICAgICBpZiAodmFsaWQpIHsgIC8vIOihqOWNleagoemqjOWQiOazlQogICAgICAgICAgdmFyIHVybCA9IGJhc2VVUkwrIi91c2VyL2xvZ2luIjsKICAgICAgICAgIGF4aW9zLmdldCh1cmwsewogICAgICAgICAgICBwYXJhbXM6ewogICAgICAgICAgICAgIHVzZXJuYW1lOnRoaXMudXNlci51c2VybmFtZSwKICAgICAgICAgICAgICBwYXNzd29yZDp0aGlzLnVzZXIucGFzc3dvcmQKICAgICAgICAgICAgfQogICAgICAgICAgfSkudGhlbigocmVzKT0+ewogICAgICAgICAgICAvL3Jlcy5kYXRhIOaJjeihqOekuuaOpeWPo+i/lOWbnueahOaVsOaNrgogICAgICAgICAgICB2YXIgdm8gPSByZXMuZGF0YTsKICAgICAgICAgICAgaWYgKHZvLmNvZGUgPT09IDEwMDAwKSB7CiAgICAgICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oInVzZXJuYW1lIiwgdm8uZGF0YS51c2VybmFtZSkgIC8vIOWtmOWCqOeUqOaIt+S/oeaBr+WIsOa1j+iniOWZqAogICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCJpbWciLCB2by5kYXRhLnVzZXJJbWcpICAvLyDlrZjlgqjnlKjmiLfkv6Hmga/liLDmtY/op4jlmagKICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidG9rZW4iLHZvLm1zZykKICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgidXNlcklkIix2by5kYXRhLnVzZXJJZCkKICAgICAgICAgICAgICAvLyDliqjmgIHorr7nva7lvZPliY3nlKjmiLfnmoTot6/nlLEKICAgICAgICAgICAgICB0aGlzLiRtZXNzYWdlLnN1Y2Nlc3MoIueZu+W9leaIkOWKnyIpCiAgICAgICAgICAgICAgdGhpcy5nZXRJcCgpCiAgICAgICAgICAgICAgbGV0IGhvc3ROYW1lID0gdGhpcy4kcm91dGUucXVlcnkucmVkaXJlY3Q7ICAvLyDojrflj5bln5/lkI0KICAgICAgICAgICAgICBpZiAoaG9zdE5hbWUgIT1udWxsKSB7ICAgLy8g5Yik5pat5aaC5p6c5Z+f5ZCN5piv5L2g6aG555uu5Z+f5ZCN77yM6K+05piO5piv5LuO5pys572R56uZ5YaF6YOo6Lez6L2s6L+H5p2l55qE77yMCiAgICAgICAgICAgICAgICB0aGlzLiRyb3V0ZXIucHVzaChob3N0TmFtZSk7ICAgLy8g55m75b2V5oiQ5Yqf5ZCO77yM6L+U5Zue5LiK5qyh6L+b5YWl55qE6aG16Z2i77ybCiAgICAgICAgICAgICAgfSBlbHNlIHsKICAgICAgICAgICAgICAgIHRoaXMuJHJvdXRlci5wdXNoKCIvIik7ICAvLyDoi6XkuI3mmK/nvZHnq5nlhoXpg6jot7Povazov4fmnaXnmoTvvIznmbvpmYbmiJDlip/lkI7ov5vlhaXnvZHnq5npppbpobUKICAgICAgICAgICAgICB9CiAgICAgICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICAgdGhpcy4kbWVzc2FnZS5lcnJvcihyZXMuZGF0YS5tc2cpCiAgICAgICAgICAgIH0KICAgICAgICAgIH0pCiAgICAgICAgfQogICAgICB9KTsKICAgIH0sCiAgICBsb2FkKCl7CiAgICAgIGF4aW9zLmdldChiYXNlVVJMKyIvdXNlci1sb2dpbi1oaXN0b3J5L2dldElwIikudGhlbigKICAgICAgICAgIHJlcz0+ewogICAgICAgICAgICB0aGlzLmlwPXJlcy5kYXRhCiAgICAgICAgICAgIGF4aW9zLmdldCgiaHR0cHM6Ly9yZXN0YXBpLmFtYXAuY29tL3YzL2lwIix7CiAgICAgICAgICAgICAgcGFyYW1zOnsKICAgICAgICAgICAgICAgIGlwOnJlcy5kYXRhLAogICAgICAgICAgICAgICAga2V5OiAnMTk4M2JlMzMxYzQ4ZWYyODg2N2Y2MWU2MWY4Nzg5ODcnLAogICAgICAgICAgICAgIH0KICAgICAgICAgICAgfSkudGhlbigKICAgICAgICAgICAgICAgIHJlcz0+ewogICAgICAgICAgICAgICAgICB0aGlzLnByb3ZpbmNlPXJlcy5kYXRhLnByb3ZpbmNlCiAgICAgICAgICAgICAgICAgIHRoaXMuY2l0eT1yZXMuZGF0YS5jaXR5CiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICkKICAgICAgICAgIH0KICAgICAgKQogICAgfSwKICAgIGdldElwKCl7CiAgICAgIHZhciBwb3NpdGlvbj17CiAgICAgICAgImFyZWEiOnRoaXMuY2l0eSwKICAgICAgICAiaXAiOnRoaXMuaXAsCiAgICAgICAgInVzZXJJZCI6bG9jYWxTdG9yYWdlLmdldEl0ZW0oInVzZXJJZCIpLAogICAgICAgICJjb3VudHJ5Ijp0aGlzLnByb3ZpbmNlCiAgICAgIH0KICAgICAgYXhpb3MucG9zdChiYXNlVVJMKyIvdXNlci1sb2dpbi1oaXN0b3J5L2luc2VydCIscG9zaXRpb24pCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;AAuBA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"wrapper\">\n    <div\n        style=\"margin: 200px auto; background-color: #fff; width: 350px; height: 300px; padding: 20px; border-radius: 10px\">\n      <div style=\"margin: 20px 0; text-align: center; font-size: 24px\"><b>登 录</b></div>\n      <el-form  :model=\"user\"  ref=\"userForm\" :rules=\"rules\">\n        <el-form-item prop=\"username\">\n          <el-input size=\"medium\" style=\"margin: 10px 0\" prefix-icon=\"el-icon-user\" v-model=\"user.username\"></el-input>\n        </el-form-item>\n        <el-form-item prop=\"password\">\n          <el-input size=\"medium\" style=\"margin: 10px 0\" prefix-icon=\"el-icon-lock\" show-password\n                    v-model=\"user.password\"></el-input>\n        </el-form-item>\n        <el-form-item style=\"margin: 10px 0; text-align: right\">\n          <el-button type=\"warning\" size=\"small\" autocomplete=\"off\" @click=\"$router.push('/register')\">注册</el-button>\n          <el-button type=\"primary\" size=\"small\" autocomplete=\"off\" @click=\"login\">登录</el-button>\n        </el-form-item>\n      </el-form>\n    </div>\n  </div>\n</template>\n\n<script>\nimport {baseURL} from \"../../public/urlConfig\";\nimport axios from \"axios\";\n\nexport default {\n  name: \"Login\",\n  data() {\n    return {\n      user:{},\n      ip:\"\",\n      province:\"\",\n      city:\"\",\n      rules: {\n        username: [\n          {required: true, message: '请输入用户名', trigger: 'blur'},\n          {min: 1, message: '不能为空', trigger: 'blur'}\n        ],\n        password: [\n          {required: true, message: '请输入密码', trigger: 'blur'},\n          {min: 1,  message: '不能为空', trigger: 'blur'}\n        ],\n      }\n    }\n  },\n  created() {\n    this.load()\n  },\n  methods: {\n    login() {\n      this.$refs['userForm'].validate((valid) => {\n        if (valid) {  // 表单校验合法\n          var url = baseURL+\"/user/login\";\n          axios.get(url,{\n            params:{\n              username:this.user.username,\n              password:this.user.password\n            }\n          }).then((res)=>{\n            //res.data 才表示接口返回的数据\n            var vo = res.data;\n            if (vo.code === 10000) {\n              localStorage.setItem(\"username\", vo.data.username)  // 存储用户信息到浏览器\n              localStorage.setItem(\"img\", vo.data.userImg)  // 存储用户信息到浏览器\n              localStorage.setItem(\"token\",vo.msg)\n              localStorage.setItem(\"userId\",vo.data.userId)\n              // 动态设置当前用户的路由\n              this.$message.success(\"登录成功\")\n              this.getIp()\n              let hostName = this.$route.query.redirect;  // 获取域名\n              if (hostName !=null) {   // 判断如果域名是你项目域名，说明是从本网站内部跳转过来的，\n                this.$router.push(hostName);   // 登录成功后，返回上次进入的页面；\n              } else {\n                this.$router.push(\"/\");  // 若不是网站内部跳转过来的，登陆成功后进入网站首页\n              }\n            } else {\n              this.$message.error(res.data.msg)\n            }\n          })\n        }\n      });\n    },\n    load(){\n      axios.get(baseURL+\"/user-login-history/getIp\").then(\n          res=>{\n            this.ip=res.data\n            axios.get(\"https://restapi.amap.com/v3/ip\",{\n              params:{\n                ip:res.data,\n                key: '1983be331c48ef28867f61e61f878987',\n              }\n            }).then(\n                res=>{\n                  this.province=res.data.province\n                  this.city=res.data.city\n                }\n            )\n          }\n      )\n    },\n    getIp(){\n      var position={\n        \"area\":this.city,\n        \"ip\":this.ip,\n        \"userId\":localStorage.getItem(\"userId\"),\n        \"country\":this.province\n      }\n      axios.post(baseURL+\"/user-login-history/insert\",position)\n    }\n  }\n}\n</script>\n\n<style scoped>\n.wrapper {\n  height: 100vh;\n  background-image: linear-gradient(to bottom , #42b983, #3F5EFB);\n  overflow: hidden;\n}\n</style>\n"]}]}